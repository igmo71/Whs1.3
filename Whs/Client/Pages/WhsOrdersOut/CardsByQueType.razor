@page "/WhsOrdersOut/CardsByQueType"
@page "/WhsOrdersOut/CardsByQueType/{SearchStatus}"

@using Microsoft.AspNetCore.Authorization
@using Whs.Client.Components

@attribute [Authorize]

<Notification @ref="Notification" />

<input type="hidden" id="Barcode" value="@Barcode" @onchange="ScannedBarcodeAsync" />

<div class="row">
    <div class="col">
        <h3>Расходные ордера на товары</h3>
    </div>
</div>
<div class="row">
    <div class="col d-print-none">
        @if (Warehouses != null)
        {
            <SearchByWarehouseAsync Warehouses="Warehouses" OnSelect="SearchByWarehouseAsync" />
        }
    </div>
    <div class="col d-print-none">
        <SearchByNumber @ref="SearchByNumber" OnSearchChanged="SearchByNumberAsync" />
    </div>
    <div class="col">
        @if (Destinations != null)
        {
            <SearchByDestination @ref="SearchByDestination" Destinations="Destinations" OnSelect="SearchByDestinationsAsync" />
        }
    </div>
    <div class="col">
        @if (OrdersDto != null)
        {
            <strong>Общ вес: @OrdersDto.TotalWeight</strong>
        }
    </div>
    <div class="col mb-2 d-print-none">
        <button class="btn btn-info" @onclick="PrintAsync"><span class="oi oi-print"></span> Печать </button>
    </div>
</div>

<ul class="nav nav-tabs nav-fill">
    <li class="nav-item">
        <button class="btn btn-link btn-lg btn-block nav-link @SearchStatusButtons["Подготовлено"]" @onclick="@(() => SearchByStatus("Подготовлено"))">Подготовлено</button>
    </li>
    <li class="nav-item">
        <button class="btn btn-link btn-lg btn-block nav-link @SearchStatusButtons["К отбору"]" @onclick="@(() => SearchByStatus("К отбору"))">К отбору</button>
    </li>
    <li class="nav-item">
        <button class="btn btn-link btn-lg btn-block nav-link @SearchStatusButtons["К отгрузке"]" @onclick="@(() => SearchByStatus("К отгрузке"))">К отгрузке</button>
    </li>
    <li class="nav-item">
        <button class="btn btn-link btn-lg btn-block nav-link @SearchStatusButtons["Отгружен"]" @onclick="@(() => SearchByStatus("Отгружен"))">Отгружен</button>
    </li>
</ul>

@if (OrdersDto == null)
{
    <p><em>Загрузка...</em></p>
}
else
{
    @if (OrdersDto?.MngrOrderName != null)
    {
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <strong>@OrdersDto.MngrOrderName</strong>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close" @onclick="SearchByBarcodeClearAsync">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    <div class="row">
        @foreach (var item in OrdersDto.Items)
        {
            <div class="col">
                <div class="row align-middle text-center">@item.Key</div>
                @foreach (var value in item.Value)
                {
                    string ifExpired = "";
                    string ifMoving = "";
                    if ((value.СрокВыполнения != DateTime.Parse("01.01.0001 0:00:00")) && value.СрокВыполнения < DateTime.Now)
                        ifExpired = "bg-danger text-white";
                    if (value.ЭтоПеремещение)
                        ifMoving = "bg-warning text-white";

                    <div class="row" @onclick="@(() => OpenItem(value.Документ_Id))">
                        @*<Card Value="value" />*@
                        <div class="card border border-dark rounded w-100 m-2">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col">
                                        @value.Склад_NameString
                                    </div>
                                    <div class="col h1 align-middle text-right">
                                        @value.НомерОчереди
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <span class="oi oi-timer"> &nbsp; </span> <span class="@ifExpired"> @value.СрокВыполнения </span>
                                </div>
                                <div class="row">
                                    <span class="oi oi-location"> &nbsp; </span> <span> @value.НаправлениеДоставки_Name </span>
                                </div>
                                <div class="row">
                                    <span class="oi oi-people"> &nbsp; </span> <span class="@ifMoving"> @value.ОтправительПолучатель_NameString </span>
                                </div>
                                <div class="row">
                                    <span class="oi oi-warning"> &nbsp; </span> <span> @value.КомментарийString </span>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="float-left">Строк: @value.КоличествоСтрок</div>
                                <div class="float-right">Вес: @value.Вес</div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
}